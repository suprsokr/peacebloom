#!/bin/bash
# Build Thorium modding CLI from source
# Run this inside the container

set -e

echo "=== Building Thorium Modding CLI ==="

THORIUM_DIR="/home/peacebloom/thorium"

# Check if Thorium source exists
if [ ! -f "$THORIUM_DIR/Makefile" ]; then
    echo "Error: Thorium source not found at $THORIUM_DIR"
    echo "Make sure thorium/ is mounted in docker-compose.yml"
    exit 1
fi

cd "$THORIUM_DIR"

# Build Thorium with StormLib (all-in-one binary)
echo "Building Thorium CLI with StormLib..."
make clean 2>/dev/null || true
make build

# Install to /usr/local/bin
echo "Installing Thorium to /usr/local/bin..."
sudo cp build/thorium /usr/local/bin/thorium
sudo chmod +x /usr/local/bin/thorium

# Verify installation
echo ""
echo "=== Build Complete ==="
thorium version
echo ""
echo "Thorium installed to: /usr/local/bin/thorium"
echo "Run 'thorium help' for usage information."
echo ""
